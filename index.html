<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cine DB - Presentación</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
</head>
<body>
    <header>  
       <div class="logo"><i class="bi bi-camera-reels" style="vertical-align: middle; margin-right: 8px;"></i>Cine DB</div>
        <nav>
            <ul>
                
                <li><a href="#" id="btnNosotros">Sobre Nosotros</a></li>
                <li><a href="#" id="btnConsultas">Consultas</a></li>
                <li><a href="#" id="btnPorque">¿Por qué elegirnos?</a></li>
            </ul>
        </nav>
    </header>

    <section id="sobre-nosotros">
        <h1>Sobre Nosotros</h1>
        <div class="cards">
            <div class="card"><h3>Cobos Robert , Lorenzo </h3><p>Legajo: 421527 </p></div>
            <div class="card"><h3>Cantero, Ignacio Javier</h3><p>Legajo: 421797 </p></div>
            <div class="card"><h3>Bonfanti, Galo </h3><br><p>Legajo: 421253 </p></div>
            <div class="card"><h3>Aris, Federico Nicolas</h3><p>Legajo: 421442 </p></div>
            <div class="card"><h3>Iriarte, Franco Nicolas </h3><p>Legajo: 421708</p></div>
        </div>
    </section>

    <section id="consultas" class="hidden">
        <button id="themeToggle" class="theme-btn" title="Cambiar tema">
            <i class="bi bi-moon-fill"></i>
        </button>
        <h1>Consultas SQL</h1>

        <div class="consulta">
            <h3>Consulta 1</h3>
            <button class="btn-enunciado">Mostrar Enunciado</button>
            <p class="enunciado hidden">Crear una vista que guarde una consulta que muestre desde 2015, el promedio de
espectadores por función; la recaudación total por cine y por película; y la cantidad total de
espectadores por película.
 Consulte la vista anterior para mostrar el cine, la película y la recaudación total solo de
aquellas películas cuya recaudación supere el promedio general de recaudación.</p>
            <br> </br>
            <pre>CREATE VIEW vista_estadisticas_cine AS
SELECT 
    c.Nombre_Cine, 
    p.Titulo AS Pelicula, 
    COUNT(b.id_Boleto) * 1.0 / COUNT(DISTINCT pp.id_Programacion) AS PromedioEspectadoresPorFuncion,
    SUM(df.precio_total) AS RecaudacionTotal,
    COUNT(b.id_Boleto) AS TotalEspectadores
FROM factura f
JOIN detalle_factura df ON f.id_Factura = df.id_Factura
JOIN boletos b ON df.id_Boleto = b.id_Boleto
JOIN programacion_peliculas pp ON b.id_Programacion = pp.id_Programacion
JOIN salas s ON pp.id_Sala = s.Id_Sala
JOIN cines c ON s.Id_Cine = c.Id_Cine
JOIN peliculas p ON pp.id_Pelicula = p.id_Pelicula
WHERE YEAR(pp.Fecha) >= 2015
GROUP BY c.Nombre_Cine, p.Titulo;

SELECT Nombre_Cine, Pelicula, RecaudacionTotal
FROM vista_estadisticas_cine
WHERE RecaudacionTotal > (
    SELECT AVG(RecaudacionTotal)
    FROM vista_estadisticas_cine
)
ORDER BY RecaudacionTotal DESC;</pre>
            <button class="btn-ejecutar" data-img="imagen1.jpg">EJECUTAR</button>
       
            <div class="resultado"></div>
        </div>

        <div class="consulta">
            <h3>Consulta 2</h3>
<button class="btn-enunciado">Mostrar Enunciado</button>
            <p class="enunciado hidden">1. Crear un procedimiento almacenado que permita clasificar a los clientes del cine en
dos categorías (“Premium” y “Estándar”) según el precio promedio de los boletos que compraron
durante el último año.
 Se considerará cliente “Premium” a aquel cuyo precio promedio por boleto supere el
promedio general de precios de todos los boletos vendidos en ese período, y “Estándar” en caso
contrario.
 El procedimiento deberá mostrar el código y nombre del cliente, la cantidad total de
boletos adquiridos, el monto total gastado, el precio promedio por boleto y el tipo de cliente
asignado</p>
<br> </br>
            <pre>SELECT 
    c.id_Cliente,
    c.[Nom_Cliente],
    COUNT(b.id_Boleto) AS Cantidad_Boletos,
    SUM(df.precio_total) AS Total_Gastado,
    AVG(b.precio_unitario) AS Promedio_Precio,
    'Premium' AS Tipo_Cliente
FROM clientes c
JOIN factura f ON c.id_Cliente = f.id_Cliente
JOIN detalle_factura df ON f.id_Factura = df.id_Factura
JOIN boletos b ON df.id_Boleto = b.id_Boleto
WHERE f.Fecha_Factura >= DATEADD(YEAR, -1, GETDATE())
GROUP BY c.id_Cliente, c.[Nom_Cliente]
HAVING AVG(b.precio_unitario) >
       (SELECT AVG(b2.precio_unitario)
        FROM boletos b2
        JOIN detalle_factura df2 ON b2.id_Boleto = df2.id_Boleto
        JOIN factura f2 ON f2.id_Factura = df2.id_Factura
        WHERE f2.Fecha_Factura >= DATEADD(YEAR, -1, GETDATE()))

UNION


SELECT 
    c.id_Cliente,
    c.[Nom_Cliente],
    COUNT(b.id_Boleto) AS Cantidad_Boletos,
    SUM(df.precio_total) AS Total_Gastado,
    AVG(b.precio_unitario) AS Promedio_Precio,
    'Estándar' AS Tipo_Cliente
FROM clientes c
JOIN factura f ON c.id_Cliente = f.id_Cliente
JOIN detalle_factura df ON f.id_Factura = df.id_Factura
JOIN boletos b ON df.id_Boleto = b.id_Boleto
WHERE f.Fecha_Factura >= DATEADD(YEAR, -1, GETDATE())
GROUP BY c.id_Cliente, c.[Nom_Cliente]
HAVING AVG(b.precio_unitario) <=
       (SELECT AVG(b2.precio_unitario)
        FROM boletos b2
        JOIN detalle_factura df2 ON b2.id_Boleto = df2.id_Boleto
        JOIN factura f2 ON f2.id_Factura = df2.id_Factura
        WHERE f2.Fecha_Factura >= DATEADD(YEAR, -1, GETDATE()));
     </pre>
            
            <button class="btn-ejecutar" data-img="imagen2.jpg">EJECUTAR</button>
            <div class="resultado"></div>
        </div>

        <div class="consulta">
            <h3>Consulta 3</h3>
            <button class="btn-enunciado">Mostrar Enunciado</button>
            <p class="enunciado hidden">3. Crear un procedimiento almacenado que sea capaz de determinar la cantidad de
películas de un género y un formato pasados por parámetros que fueron transmitidas entre los
años 2023 y 2025 y que la duración sea mayor al promedio del total de las películas. En el caso de
que solo haya una, especificar su título.</p>
<br> </br>
            <pre>CREATE PROCEDURE Pa_Pel_Gen_Form
    @genero VARCHAR(50),
    @formato VARCHAR(50),
    @cantidadPeliculas INT = 0 OUTPUT,
    @nombre VARCHAR(100) = NULL OUTPUT
AS 
BEGIN 
    IF @genero IS NULL 
    BEGIN 
        PRINT('Debe ingresar un valor valido de genero');
        RETURN;
    END;

    IF @formato IS NULL
    BEGIN
        PRINT('Debe ingresar un valor valido de formato');
        RETURN;
    END;

    BEGIN
        SELECT DISTINCT
            @cantidadPeliculas = COUNT(p.id_Pelicula),
            @nombre = p.titulo
        FROM peliculas AS p
        JOIN genero_peliculas AS gp ON gp.id_Pelicula = p.id_Pelicula
        JOIN generos AS g ON gp.id_Genero = g.id_Genero
        JOIN programacion_peliculas AS pp ON pp.id_Pelicula = p.id_Pelicula
        JOIN formato_pelicula AS fp ON fp.id_Formato_Pelicula = pp.id_Formato_Pelicula
        WHERE YEAR(pp.Fecha) BETWEEN 2023 AND 2025
            AND fp.Formato = @formato
            AND g.Genero = @genero
        GROUP BY p.Titulo, p.Duracion
        HAVING p.Duracion > (
            SELECT AVG(duracion)
            FROM peliculas
        );
    END;

    BEGIN
        IF @cantidadPeliculas = 0
            PRINT('No hay ninguna pelicula que cumpla la condicion con ese genero y formato');
        ELSE IF @cantidadPeliculas = 1
            PRINT(CONCAT('Solo una pelicula cumple con la condicion y su titulo es: ', @nombre));
        ELSE
            PRINT(CONCAT('La cantidad de peliculas que cumplen con la condicion son: ', 
                  REPLACE(STR(@cantidadPeliculas), ' ', '')));
    END;
END;

EXEC Pa_Pel_Gen_Form 'romance', '2D';</pre>
            <button class="btn-ejecutar" data-img="imagen3.jpg">EJECUTAR</button>
            <div class="resultado"></div>
        </div>

        <div class="consulta">
            <h3>Consulta 4</h3>
            <button class="btn-enunciado">Mostrar Enunciado</button>
            <p class="enunciado hidden">Muestra cada cine con su ubicación, la recaudación total (entradas + productos), la recaudación específica por películas y por productos, además de indicar cuál fue la película más vista y el producto más vendido en cada uno.</p>
          <br> </br>
  <pre>SELECT 
    c.Nombre_Cine AS [Cine],
    ci.Nombre_Ciudad AS [Ubicacion],

    (
        SELECT 
        SUM(df.precio_total) + SUM(dfp.cantidad * dfp.Precio_Unitario)
		-- El cine de las rosas no tiene recaudacion de productos, por lo tanto, 5500 + null = null, lo arreglamos despues con algun insert 
        FROM factura f
        JOIN detalle_factura df ON f.id_Factura = df.id_Factura
        JOIN boletos b ON df.id_Boleto = b.id_Boleto
        JOIN programacion_peliculas pp ON b.id_Programacion = pp.id_Programacion
        JOIN salas s ON pp.id_Sala = s.Id_Sala
        JOIN detalle_factura_productos dfp ON f.id_Factura = dfp.id_Factura
        WHERE s.Id_Cine = c.Id_Cine
    ) AS [Recaudacion Total],

 
    (
        SELECT 
         SUM(df.precio_total) 
        FROM detalle_factura df
        JOIN boletos b ON df.id_Boleto = b.id_Boleto
        JOIN programacion_peliculas pp ON b.id_Programacion = pp.id_Programacion
        JOIN salas s ON pp.id_Sala = s.Id_Sala
        WHERE s.Id_Cine = c.Id_Cine
    ) AS [Recaudacion Peliculas],


    (
        SELECT 
        SUM(dfp.cantidad * dfp.Precio_Unitario) 
        FROM detalle_factura_productos dfp
        JOIN factura f ON dfp.id_Factura = f.id_Factura
        JOIN detalle_factura df ON f.id_Factura = df.id_Factura
        JOIN boletos b ON df.id_Boleto = b.id_Boleto
        JOIN programacion_peliculas pp ON b.id_Programacion = pp.id_Programacion
        JOIN salas s ON pp.id_Sala = s.Id_Sala
        WHERE s.Id_Cine = c.Id_Cine
    ) AS [Recaudacion Productos],


    (
        SELECT TOP 1 p.Titulo
        FROM detalle_factura df
        JOIN boletos b ON df.id_Boleto = b.id_Boleto
        JOIN programacion_peliculas pp ON b.id_Programacion = pp.id_Programacion
        JOIN peliculas p ON pp.id_Pelicula = p.id_Pelicula
        JOIN salas s ON pp.id_Sala = s.Id_Sala
        WHERE s.Id_Cine = c.Id_Cine
        GROUP BY p.Titulo
        ORDER BY COUNT(df.id_Boleto) DESC
    ) AS [Pelicula mas vista],


    (
        SELECT TOP 1 pr.Descripcion
        FROM detalle_factura_productos dfp
        JOIN productos pr ON dfp.id_Producto = pr.id_Producto
        JOIN factura f ON dfp.id_Factura = f.id_Factura
        JOIN detalle_factura df ON f.id_Factura = df.id_Factura
        JOIN boletos b ON df.id_Boleto = b.id_Boleto
        JOIN programacion_peliculas pp ON b.id_Programacion = pp.id_Programacion
        JOIN salas s ON pp.id_Sala = s.Id_Sala
        WHERE s.Id_Cine = c.Id_Cine
        GROUP BY pr.Descripcion
        ORDER BY SUM(dfp.cantidad) DESC
    ) AS [Producto mas vendido]

FROM cines c
JOIN barrios b ON c.Id_Barrio = b.Id_Barrio
JOIN ciudades ci ON b.Id_Ciudad = ci.Id_Ciudad
ORDER BY [Recaudacion Total] DESC;</pre>
            <button class="btn-ejecutar" data-img="imagen4.jpg">EJECUTAR</button>
            <div class="resultado"></div>
        </div>

        <div class="consulta">
            <h3>Consulta 5</h3>
            <button class="btn-enunciado">Mostrar Enunciado</button>
            <p class="enunciado hidden"></p>
           <br> </br>
            <pre>SELECT 
    Cliente,
    COUNT(*) AS Visitas 
FROM Ventas 
GROUP BY Cliente 
ORDER BY Visitas DESC;</pre>
            <button class="btn-ejecutar" data-img="imagen5.jpg">EJECUTAR</button>
            <div class="resultado"></div>
        </div>
    </section>

    <section id="porque-elegirnos" class="hidden">
        <h1>¿Por qué elegir Cine DB?</h1>
        <p class="intro-text">
            En la industria del cine, cada entrada vendida, cada butaca ocupada y cada película proyectada es un dato valioso.
            Se requiere una <strong>gestión inteligente</strong>. Y ahí es donde entra nuestra base de datos.
        </p>
        
        <ul class="features">
            <li>
                <h3> Reglas de Negocio Real</h3>
                 <p>
                No se trata solo de guardar datos, sino de entenderlos.  
                Con Cine DB podés analizar resultados al instante: 
                descubrir cuál película deja más ganancias (<strong>Consulta 1</strong>), 
                o reconocer a tus clientes más fieles (<strong>Consulta 2</strong>).                  
            </p>
            </li>

            <li>
                <h3>Escalabilidad y Flexibilidad</h3>
                <p>
                   Cine DB está pensada para crecer sin perder el orden.  
                   Su estructura permite agregar nuevas películas, salas o funciones de forma simple,  
                   sin necesidad de modificar la base ni romper relaciones.  
                   La coherencia entre los datos se mantiene, asegurando que todo encaje incluso cuando el sistema se amplía.  
                   Si mañana el cine suma más sucursales o nuevos formatos, la base ya está preparada.
            </li>
            <li>
                <h3> Decisiones Basadas en Datos</h3>
             <p>
        Para nosotros, gestionar un cine no debería depender de la intuición.  
        Cada decisión puede basarse en datos reales:  
        Ver qué cine recauda más, cuál película lidera las Ventas
        y qué producto es el más vendido (<strong>Consulta 4</strong>).  
        Todo está ahí, listo para convertir datos en información y luego en <strong>estrategia.</strong>
             </p>
            </li>
        </ul>
        <p class="intro-text" style="font-weight: 700; margin-top: 30px;">
            Cine DB no es solo una base de datos. Es su socio estratégico
        </p>
    </section>


    <script src="index.js"></script>
</body>
</html>
